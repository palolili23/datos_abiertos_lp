---
title: "asistencia escolar"
author: "Paloma"
date: "2/1/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---


```{r, include = FALSE,}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, out.width = "100%")
```

```{r}
library(rio)
library(here)
library(tidyverse)
library(tidytext)
```

```{r}
censo <- import(here("02_datos_limpios", "censo.RData"))
```

```{r}
asistencia_esc <- censo %>% 
  rename(
    ae_hombres = `h_ae(6_19)`,
    ae_mujeres = `m_ae(6_19)`) %>% 
  select(depto, prov, municipio, starts_with("ae")) %>%   pivot_longer(
    cols = -c(1:3),
    names_to = "sexo",
    values_to = "t_asistencia_escolar",
    names_prefix = "ae_"
  ) %>% 
  mutate(sexo = 
           ifelse(str_detect(sexo, "hombres"), "Niños", "Niñas"))
```

```{r}
asistencia_esc %>% 
  mutate(depto = str_remove(depto, "Departamento de")) %>% 
  mutate(depto = fct_reorder(depto, t_asistencia_escolar)) %>% 
  ggplot(aes(depto, t_asistencia_escolar, color = sexo)) +
  geom_boxplot() +
  scale_color_manual(values = c("#d11141", "#00b159" ) ) +
  coord_flip() +
  scale_y_reverse() +
  theme_minimal() +
    labs(
    title = "Distribución de la taza de asistencia escolar por departamento,\npara niñas y niños entre 6 y 19 años ",
    caption = "Fuente: Censo 2012, INDEC",
    x= "",
    y = "Taza de alfabetización (%)"
  ) 
```

```{r}
asistencia_esc %>% 
  mutate(sexo = fct_rev(sexo)) %>% 
  ggplot(aes(sexo, t_asistencia_escolar, group = municipio)) +
  geom_point(aes(color = sexo)) +
  scale_color_manual(values = c("#d11141", "#00b159")) +
  geom_line(color = "#ffc425") +
  facet_wrap(.~depto) +
  theme_minimal() +
  labs(title = "Taza de asistencia escolar para niñes entre 6 19 años, por municipio",
       x = "Niños vs. niñas",
       y = "Taza de alfabetización",
       caption = "Datos de INDEC") 

```

```{r}
asistencia_esc %>% 
  group_by(depto, prov, sexo) %>% 
  summarize(media_ae = median(t_asistencia_escolar)) %>% 
  ungroup() %>% 
  mutate(prov = reorder_within(prov, media_ae, depto)) %>% 
  pivot_wider(
    names_from = sexo,
    values_from = media_ae) %>% 
  ggplot() +
  geom_segment(aes(x = prov, xend = prov, y = Niñas, yend = Niños), color = "#ffc425") +
  geom_point(aes(x = prov, y = Niñas), color = "#d11141", size = 2) +
  geom_point(aes(x = prov, y = Niños), color = "#00b159", size = 2) +
  coord_flip() +
  facet_wrap(.~depto, scale = "free_y") +
  theme_minimal() +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank()) +
  labs(
    title = "Taza de asistencia escolar promedio por provincia, \npara niñas y niños mayores a 15 años ",
    subtitle = "En rojo la taza para niñas, en verde la taza para niños",
    caption = "Fuente: Censo 2012, INDEC",
    x= "Provincias",
    y = ""
  ) 
```

